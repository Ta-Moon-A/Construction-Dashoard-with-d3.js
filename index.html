<html>
<head>
    <meta charset="UTF-8">
    <title>Construction Dashbaord </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
     body * {
         font-family : 'Helvetica'
     }
    .toolTip {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        position: absolute;
        display: none;
        width: auto;
        height: auto;
        /*background: none repeat scroll 0 0 white;*/
        background: rgba(255,255,255,1);	
        border: 0 none;
        border-radius: 8px 8px 8px 8px;
        box-shadow: -3px 3px 15px #888888;
        color: black;
        font: 12px sans-serif;
        padding: 5px;
        text-align: center;
       
    }
    </style>
</head>

<body translate="no">

  <div  style="position: relative;">
      <div>
           <button onclick="TestPies()">Test Pies</button>
           <button onclick="testLine()">Test Line</button>
      </div>
      <div id ="myLine"  style="float: left;">
          <p>Line Chart</p>
      </div>

      <div id ="myPie1" style="float: left;">
          <p></p>
      </div>

      <div id ="myPie2" style="float: left;">
          <p></p>
      </div>
  </div>
  <!--<div>
      <div id ="myCrossFilter" style="float: left;">
          <p>Cross Filter</p>
      </div>
  </div>-->
    <script src="js/d3.v4.min.js"></script>
    <script src="js/processData.js"></script>
    <script src="js/d3scriptfilter.js"></script>
    <script src="js/d3scriptline.js"></script>
    <script src="js/d3scriptpie.js"></script>
    <script src="js/tooltip.js"></script>

<script>

   var pie2Chart;

    d3.csv("data/Constructions.csv", function(data) {
        var result = [];
        data.forEach(function(d) {
            for (var property in d) {
                    if (d.hasOwnProperty(property)) {
                        if(!isNaN(property))
                        {
                            result.push({
                                region : d.Region,
                                year : property,
                                value : d[property]
                            });
                        }
                    }
                }
        });

        

        var dataGroupedByRegion = GetRegionData(result);
        var dataGroupedByYear = GetYearlyData(result);
      


          var lineChart = renderLineChart()
                         .data('Pass Something Here and use it as attrs.data')
         
          var pie1Chart = renderPieChart()
                         .data({title : "Sum Of Constructions By Region", 
                                data : dataGroupedByRegion,
                                tooltip : true,
                                outerLabel : true,
                                shuffleSlices : true})
                         .color('#796799')
                         .tooltipRows( [{ left: "Region", right: "{label}"},{left: "Quantity", right: "{value}"}])

           pie2Chart = renderPieChart()
                         .data({title : "Average Construnctions Number By Years", 
                                data : dataGroupedByYear, 
                                tooltip : true,
                                outerLabel : true,
                                shuffleSlices : false})
                         .color('#EF4836')
                         .tooltipRows( [{ left: "Year", right: "{label}"},{left: "Avg Constr. Number", right: "{value}"}])

          var filterChart = renderCrossFilter()
                         .data('Pass Something Here and use it as attrs.data')
                         .onFilterChange(d=>{
                             pie2Chart.data(d);
                             pie1Chart.data(d);
                             lineChart.data(d);
                         })
           
          d3.select("#myLine").call(lineChart);
          d3.select("#myPie1").call(pie1Chart);
          d3.select("#myPie2").call(pie2Chart);
          d3.select("#myCrossFilter").call(filterChart);

    });

    function TestPies(){
        var result = [{"region":"Tbilisi","year":"2011","value":"425669"},
                      {"region":"Tbilisi","year":"2012","value":"821126"},
                       {"region":"Adjara","year":"2013","value":"318193"},
                    {"region":"Guria","year":"2011","value":"21605"},
                    {"region":"Guria","year":"2013","value":"6293"},
                     {"region":"Imereti","year":"2011","value":"49860"},
                      {"region":"Imereti","year":"2012","value":"99960"},
                      {"region":"Imereti","year":"2013","value":"60804"},
                      {"region":"Kakheti","year":"2014","value":"87775"},
                     {"region":"Mtskheta","year":"2011","value":"34996"},
                     {"region":"Samegrelo","year":"2011","value":"43158"},
                      {"region":"Samegrelo","year":"2012","value":"62885"},
                    {"region":"Samtskhe","year":"2011","value":"21905"},
                      {"region":"Shida Kartli","year":"2011","value":"9391"},
                      {"region":"Racha","year":"2011","value":"8243"},
                      {"region":"Racha","year":"2012","value":"810"},
                     {"region":"Kvemo Kartli","year":"2011","value":"48040"}];

        var dataGroupedByRegion = GetRegionData(result);
        var dataGroupedByYear = GetYearlyData(result);
        
        

        pie2Chart.data({title : "Average Construnctions Number By Years", 
                        data : dataGroupedByYear, 
                        tooltip : true,
                        outerLabel : true,
                        shuffleSlices : false});
    };
</script>

</body>
</html>